from datetime import UTC, datetime

from t8_client.utils import (
    decode_array,
    format_timestamp,
    format_timestamps,
    parse_pmode_item,
    parse_wave_item,
)


def test_parse_wave_item():
    link = {
        "_links": {
            "self": "http://lzfs45.mirror.twave.io/lzfs45/rest/waves/LP_Turbine/MAD32CY005/AM2/1554907724"
        }
    }
    expected = 1554907724

    # datetime(2019, 4, 10, 14, 48, 44, tzinfo=UTC)
    assert parse_wave_item(link) == expected


def test_parse_pmode_item():
    link = {
        "_links": {
            "self": "http://lzfs45.mirror.twave.io/lzfs45/rest/waves/LP_Turbine/MAD32CY005/AM2/"
        }
    }

    expected = {"machine": "LP_Turbine", "point": "MAD32CY005", "pmode": "AM2"}
    assert parse_pmode_item(link) == expected


def test_format_timestamp():
    timestamp = 1633024800  # example timestamp
    result = format_timestamp(timestamp)
    expected = datetime.fromtimestamp(timestamp, tz=UTC).isoformat()
    assert result == expected


def test_format_timestamps():
    timestamps = [1633024800, 0, 1633111200]
    result = format_timestamps(timestamps)
    expected = [
        datetime.fromtimestamp(1633024800, tz=UTC).isoformat(),
        datetime.fromtimestamp(1633111200, tz=UTC).isoformat(),
    ]
    assert result == expected


def test_decode_array():
    zint_raw = b"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"  # noqa: E501
    array_len = 4096
    first_value = -31540.0

    result = decode_array(zint_raw, fmt="zint")
    assert len(result) == array_len
    assert result[0] == first_value
